---
title: "Friskviksjekk"
author: ""
date: "Report generated: `r Sys.Date()`"
output: html_document
---
Version: 0.2 (03.03.2023). 

For more info about the quality control, see [here](https://github.com/helseprofil/KHvalitetskontroll)!
```{r include=FALSE}
# Global settings, do not change
knitr::opts_chunk$set(cache = F, echo = F)
# Only run if functions are not already loaded. 
source("https://raw.githubusercontent.com/helseprofil/KHvalitetskontroll/main/R/setup.R")
```

# Generate full report

- This function generates a report saved to `F:/Forskningsprosjekter/PDB 2455 - Helseprofiler og til_/PRODUKSJON/VALIDERING/FRISKVIK_vs_KUBE/XXXX(profileyear)/`
- Specify profile ("FHP" or "OVP"), geolevel ("B", "K", or "F"), and profileyear.
- Some files are not handled by the system, e.g. if more kube files with the same date tag exists, or if column names are not standard. These must be checked manually.

```{r}
CheckFriskvik(profile = "FHP",
              geolevel = "F",
              profileyear = 2023)
```

# Check specific files

- To check specific FRISKVIK-file, run the chunks one-by-one interactively
- To generate an overall check, use the `CheckFriskvik()` function

# Read files

- The function generates two data objects: FRISKVIK and KUBE. These are used as input in the functions below. 
```{r}
# Use the unique date tag to identify files. This ensures that the corresponding FRISKVIK and KUBE files are loaded for comparison. 
# The function loads both files

ReadFriskvik(filename = "FILENAME", # Complete FRISKVIK file name
             profile = "FHP", # "OVP" or "FHP"
             geolevel = "K", # "B", "K", or "F", corresponding to profile geolevel
             profileyear = 2023) # 4 digit profile year

```
# Does FRISKVIK contain the latest year

- Lists the unique year (descending order) in the FRISKVIK and KUBE file. 
- Friskvik should contain the most recent year

```{r}
CompareFriskvikYear()
```
```{r}
FriskvikLastYear()
```
# All values censored in FRISKVIK is also censored in KUBE

- Compares TRUE/FALSE vector of `is.na(FRISKVIK$MEIS)` and `KUBE$SPVFLAGG > 0`
```{r}
CompareFriskvikPrikk()
```
# FRISKVIK = KUBE?

- Does the MEIS column in FRISKVIK (plotted in profile table) match a column in the KUBE?
- Checks which columns matches, and which columns are different

```{r}
CompareFriskvikVal()
```

